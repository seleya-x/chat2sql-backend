SELECT
    ds.deal_id AS DealID,
    ds.target_name AS TargetName,
    ds.acquiror_name AS AcquirorName,
    ds.date_announced AS DateAnnounced,
    ds.rank_value AS RankValue,
    SUM(CASE WHEN LOWER(fvc.type) = 'target' THEN fvc.advisor_fee ELSE 0 END) AS `Total Target Fees`,
    SUM(CASE WHEN LOWER(fvc.type) = 'acquiror' THEN fvc.advisor_fee ELSE 0 END) AS `Total Acquiror Fees`,
    dh.selection_process AS AdvisorSelectionProcess
FROM deals_summary ds
JOIN deal_history_consolidated dh ON ds.deal_id = dh.deal_id LEFT
JOIN fees_verification_consolidated fvc ON ds.deal_id = fvc.deal_id
WHERE LOWER(dh.name) LIKE '%evercore%' AND LOWER(dh.selection_process) LIKE '%bake-off%'
GROUP BY ds.deal_id, ds.target_name, ds.acquiror_name, ds.date_announced, ds.rank_value, dh.selection_process
LIMIT 20;